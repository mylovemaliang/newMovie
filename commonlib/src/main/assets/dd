define("../../common/service/user/user",["./interface/isLogin","./interface/login"],function(require,exports,module){var customEvent=$.customEvent,isLogin=require("./interface/isLogin"),login=require("./interface/login"),userInfo={init:function(){this.hasVipInfo=!1,this.isValidVip=!1,this.isNewUser=!1,this.uid="",this.name="",this.email="",this.vipType="",this.payType="",this.status="",this.isLoginInfo=null,this.qy_info=null,this.bindEvent(),this.checkUserInfo()},bindEvent:function(){customEvent.on("login",this.doLogin.bind(this)),customEvent.on("logout",this.doLogout.bind(this))},checkUserInfo:function(){if(this.isLogin()){var p00002=$.cookie.get("P00002");this.isNotEmpty(p00002)&&(p00002=window.JSON?window.JSON.parse(p00002):eval("("+p00002+")"),this.uid=p00002.uid,this.name=p00002.nickname,this.email=p00002.email)}},isLogin:function(){var a=$.cookie.get("P00002"),b=$.cookie.get("P00003");return this.isNotEmpty(a)&&a!=="deleted"&&this.isNotEmpty(b)&&b!=="deleted"},isNotEmpty:function(a){return a!==""&&a!==null},doLogin:function(){this.checkUserInfo()},doLogout:function(){this.clearUserInfo(),this.clearVipInfo()},clearUserInfo:function(){this.uid="",this.name="",this.email=""},clearVipInfo:function(){this.level="",this.vipType="",this.payType="",this.status="",this.type="",this.hasVipInfo=!1,this.isValidVip=!1},getVipLevel:function(a,b){return this.checkVipInfo("level",a,b)},getType:function(a,b){return this.checkVipInfo("type",a,b)},getVipDeadline:function(a,b){return this.checkVipInfo("vipDeadline",a,b)},getVipType:function(a,b){return this.checkVipInfo("vipType",a,b)},getPayType:function(a,b){return this.checkVipInfo("payType",a,b)},getStatus:function(a,b){return this.checkVipInfo("status",a,b)},getIsValidVip:function(a,b){return this.checkVipInfo("isValidVip",a,b)},checkVipInfo:function(a,b,c){var d=a?this[a]:"";return this.isLogin()&&(this.hasVipInfo?b&&b(d):this.getInfoFromInterface(b,a,c)),d},getInfoFromInterface:function(a,b,c){this.isLoginInfo?a&&a(b?this[b]:""):this.isLogin()&&isLogin.sendInfoAction({},function(d){d.code=="A00000"?(this.setVipInfo(d.data||{}),this.isLoginInfo=d.data.userinfo||{},this.qy_info=d.data.qiyi_vip_info||{},a(b?this[b]:"")):d.code!="A00005"&&(c&&c(),this.clearVipInfo())}.bind(this),c)},setVipInfo:function(a){var b=a.pps_vip_info||{},c=a.qiyi_vip_info||{},d=parseInt(b.vip_type,10),e=parseFloat(c.type,10);e||parseInt(c.vipType,10)&&!d?(this.vipType=String(c.vipType),this.payType=String(c.payType),this.status=String(c.status),this.level=String(c.level),this.type=String(c.type),this.hasVipInfo=!0,this.isValidVip=c.status=="1",this.vipDeadline=c.deadline):d&&(this.level=String(b.pps_level),this.vipType="1",this.payType="0",this.status="1",this.hasVipInfo=!0,this.isValidVip=!0)},getUid:function(){return this.uid},getAnonymousUid:function(){var a=$.cookie.get("QC006");return a?a:(this.isNewUser=!0,a=$.crypto.md5(window.navigator.userAgent+document.cookie+Math.random()+(new Date).getTime()*1),$.cookie.set("QC006",a,{expires:31536e6,path:"/",domain:"iqiyi.com"}),a)},checkNewUser:function(){var a=$.cookie.get("QC006");return a?this.isNewUser:!0},getName:function(){return this.name},getEmail:function(){return this.email},getAuthcookie:function(){return $.cookie.get("P00001")||""},getAutoRenew:function(a){var b="http://serv.vip.iqiyi.com/services/autoRenewQuery.action",c={};c.param={cid:"afbe8fd3d73448c9",P00001:APP.$.cookie.get("P00001"),qyid:APP.$.cookie.get("QC006")||"",cb:"__pc__getAutoRenew__"},$.ajax({url:b,dataType:"jsonp",data:c.param,success:function(b){var c=0;b.status&&(c=b.status),a&&a(c)}})},getUserIcon:function(a){this.getUserAvatar(a)},getUserAvatar:function(a){a=a||function(){},this.isLogin()&&this.getInfoFromInterface(function(b){a(b.icon.replace("_130x130","_70x70"))},"isLoginInfo")},getAccountType:function(a){var b={1:"BAIDU",2:"SINA",3:"RENREN",4:"QQ",5:"ALIPAY",6:"KAIXIN",7:"LENOVO",8:"FEIXIN",9:"WEIXIN",10:"QIYI_EMAIL",11:"QIYI_PHONE",12:"QISHENG",13:"PPS",14:"PPS_BIND"};this.getInfoFromInterface(function(c){a(b[c.accountType])},"isLoginInfo")},loginWithAuthcookie:function(a,b,c){login.loginWithAuthcookie(a,function(a){a.code=="A00000"&&($.customEvent.fire({type:"login"}),b())},c)},PPSLoginWithAuthcookie:function(a,b,c){login.PPSLoginWithAuthcookie(a,function(a){a.code=="A00000"&&($.customEvent.fire({type:"login"}),b())},c)},logout:function(a){var b=encodeURIComponent(a||window.location.href);window.location.href="http://passport.iqiyi.com/user/logout.php?url="+b+"&logoutcb=Q.__logoutcb"},getVIPStatus:function(a){var b="NOVIP",c={1:"GOLD",3:"SILVER",4:"PLATINUM"};this.isLogin()?this.getInfoFromInterface(function(d){if(d)if(d.status==0||d.status==2)b="BANNED";else if(d.status==3)b="NOVIP";else if(d.status==1){b="VALID";if(d.surplus>0||d.surplus=="")b=c[d.vipType]||"VALID"}a(b)},"qy_info"):a(b)}};userInfo.init(),module.exports=userInfo});
